# 開発支援向け AI サービス個人利用 PoC

## 報告書

### 使用する Agent の内容
- 利用する開発支援向け AI サービスの名前
  - Claude Code
- 利用するプラン
  - Pro
- ホームページ URL
  - https://docs.anthropic.com/ja/docs/claude-code/overview

### 報告書の内容
- 自分のメールアドレス
  - shion.morishita@flywheel.jp
- 所属
  - PE部
- どのように利用したか
  - ぷよぷよAI開発基盤の構築を通じて Claude Code を検証しました。具体的には以下2つのアプローチで利用：
    1. **基盤開発**: ぷよぷよエミュレータをイチから構築（C++ エンジン + Python UI）
    2. **高度なAI実装**: 連鎖探索・強化学習・プレイ学習AIの開発
  - 最初に私が「ぷよぷよAI開発基盤の構築」という大枠を示し、その後 Claude Code に「`claude.md` に記載された要件定義をもとに、タスクをチケット化してください。`/docs` 配下に配置してください。ファイルは `.md` で、ファイル名に連番を振ってください。各ファイルで TODO 管理もします」といった具体的な指示でチケット化を依頼。最終的に20個のチケットに分割し、段階的に実装を進めました。Claude Code には要件定義からのタスク分割、環境構築、C++ エンジン実装、Python バインディング、UI 開発、テスト作成・実行まで一貫して依頼しました。
- 得られた成果・良かった点
  - **18,663行のコード**（`find config cpp docs python tests training_results -type f \( -name "*.md" -o -name "*.py" -o -name "*.cpp" -o -name "*.h" -o -name "*.yaml" -o -name "*.yml" -o -name "*.json" \) -exec wc -l {} +` で計測）を生成し、完全に動作するぷよぷよエミュレータを構築できました
  - **テスト駆動開発**：各機能に対して単体テストを自動生成・実行し、バグを即座に発見・修正
  - **複数言語対応**：C++ でエンジン、Python で UI という構成を一人で効率的に実装
  - **包括的な機能実装**：連鎖システム、おじゃまぷよ、壁キック、クイックターンなどぷよぷよの複雑な仕様を正確に実装
  - **段階的開発**：チケットベースで機能を小分けすることで、複雑なプロジェクトも管理しやすく進行
- 困った点（改善方法もあれば）
  - **リポジトリ肥大化によるレート制限**：コードが大きくなると 5時間制限に早く到達。memo.md:495-535 によると、61ファイル・13,463行・359,461文字の時点で `claude -r` で履歴継承した状態での作業中に制限到達。特にチケット007b（壁キック実装の複雑な設計反映）作業中に `5-hour limit reached・resets 4pm` となり、詳細な仕様伝達とデバッグに苦労していた最中だった → 履歴なしで新セッション開始、`@` 記法でファイル明示指定による負荷軽減で対応
  - **複雑な仕様の伝達困難**：ぷよの回転・壁キックなどの複雑なルールは詳細な仕様書を何度も修正する必要があった（2時間程度消費）
  - **高度なAI実装の限界**：初期の連鎖探索・強化学習AIが低性能なのは予想通りだが、memo.md:944-968 に記載の通り、モデル改善タスク（チケット020）においてもC++実装の活用不備や学習結果の未反映など、実用レベルまでの品質向上が困難だった
  - **履歴が長いと `claude.md` のルール違反**：プロジェクトが大きくなると、事前に定めたルールを守らなくなる傾向
- 気になる点・懸念点
  - **コンテキストサイズ制限**：大規模プロジェクトでは履歴を引き継げずに知識が断絶される
  - **高度なアルゴリズム実装の品質**：動作はするが実用的な性能に達しない AI が生成される
  - **C++ の既存実装を無視**：Python で同機能を再実装してしまい、最適化された C++ コードが活用されない
  - **学習済みモデルの連携不備**：AI 学習は実行されるが、実際のゲームで学習結果が反映されない
- この AI サービスを FW 業務にどれくらい導入したいですか？
  - （0～10の11段階評価）
  - **8点**
- その理由は？
  - **基本的な開発タスクでは非常に高い生産性**を発揮し、テスト駆動開発や段階的実装が自然に行われる点が優秀です。複数言語・複雑な仕様でも対応可能で、**チケット単位での確実な実装により中規模システムを効率的に構築**できる能力は業務でも大きな価値があります。ただし、**高度なアルゴリズム実装や大規模プロジェクトでのコンテキスト制限**があるため満点ではありません。
- この AI サービスを FW の業務に導入したときの効果（ROI）はどれくらいですか？
  - （0～10の11段階評価）
  - **7点**
- その理由は？
  - 今回の利用（Pro プラン月額$20）で**18,663行の高品質コード**（前述のコマンドで計測）と**完動するシステム**を構築。memo.md の作業時間記録から、Claude Code の実作業時間は約15時間、人間が同等作業をする場合は推定60-80時間必要。**ROI計算**: 人間の工数60-80時間×時給2000円＝12-16万円の価値を月額$20（約3000円）で実現。(12-16万円)÷3000円＝**ROI約40-53倍**。ただし、**レート制限による作業中断**や**高度な機能の品質問題**により、すべてのタスクで同等の効率は期待できないため、やや控えめな評価としました。
- そのほか伝えておきたいこと
  - **チケットベースの開発手法**が非常に有効でした。複雑なプロジェクトも小さな単位に分割することで、Claude Code が迷わず実装できました。また、**`claude.md` でのルール明文化**により、テスト実施・記録などの一貫性を保てました（大規模化すると守られなくなる問題はありますが）。業務導入時は、**タスクの粒度を適切に設定**し、**高度なアルゴリズム実装は人間が担当**するという使い分けが重要だと感じました。

## 以下，自由記述欄

### 検証概要：Claude Code によるぷよぷよAI開発基盤構築

#### 検証目的
個人開発AIサービスとしての Claude Code の実用性を、以下2つの観点から評価：
1. **基盤開発タスク**: 複数技術（C++/Python）を使った中規模システム開発の効率性
2. **高度AI実装タスク**: 探索アルゴリズム・機械学習といった専門性の高い実装品質

#### プロジェクト規模
- **総コード量**: 18,663行（config, cpp, docs, python, tests, training_results 配下）
- **開発期間**: 約1ヶ月間（断続的）、Claude Code 実作業時間 約15時間
- **チケット数**: 20個（001-020）+ バグフィックス用追加チケット
- **技術スタック**: C++ (pybind11), Python (pygame), CMake, pytest

#### 構築したシステムアーキテクチャ
1. **C++ エンジン層** (約8,000行)
   - `core/`: フィールド管理、連鎖検出、重力処理、ぷよ操作
   - `ai/`: AIベースクラス、複数AI実装（Random, ChainSearch, RL, Learning）
   - `bindings/`: Python バインディング（pybind11使用）

2. **Python UI層** (約3,000行)  
   - `ui/`: pygame によるリアルタイム描画、キーボード操作
   - `examples/`: 各種動作確認・テスト用スクリプト

3. **テスト・ドキュメント** (約7,600行)
   - `tests/`: C++ 単体テスト群（各機能の動作検証）
   - `docs/`: 全チケットの仕様書・実装記録・テスト結果
   - `config/`: AI学習用設定ファイル群

#### 実装された複雑な仕様
- **壁キック**: 回転時の衝突回避（上下左右4方向の詳細判定）
- **クイックターン**: 両側壁時の180度回転（2回転操作で発動）
- **おじゃまぷよシステム**: 70点=1個送信、相殺システム、段組み配置
- **連鎖システム**: 4色以上隣接消去、重力、連鎖倍率計算、同時消し
- **エミュレータ仕様**: 時間経過による自動落下なし、明示的操作のみ

#### Claude Code の作業プロセス
1. **要件定義段階**: claude.md から20チケットへの自動分割
2. **実装段階**: チケット毎の設計→実装→テスト作成→実行→記録の一連フロー  
3. **デバッグ段階**: テスト失敗時の原因分析・修正・再テスト
4. **統合段階**: C++/Python 間バインディング、UI統合、AI統合

### 技術的成果
#### 正確に実装された複雑な仕様
- **壁キック**: 回転時の衝突回避メカニズム
- **クイックターン**: 狭い場所での180度回転
- **おじゃまぷよシステム**: 70点=1個の送信レート・相殺システム  
- **連鎖システム**: 4つ以上の同色隣接による消去・重力・連鎖倍率

#### プロンプト例
```
チケット @docs/002-game-engine-core.md を実施してください。
ビット演算でフィールド処理を行なってほしいです。
テスト作成・実行・記録も @claude.md のルールに従って実施してください。
```

### 開発効率の分析
#### 時間効率
- **基本機能**: 各チケット 15-30分で完了
- **複雑な仕様**: 壁キック実装で 2時間（仕様伝達に時間）  
- **総開発時間**: memo.md の記録から約15時間（Claude Code の実作業時間）で完全なシステム構築

#### コード品質
- すべての機能に単体テストを自動生成
- C++/Python 混在でも一貫した設計
- 実際に動作するゲームまで完成

### 限界と課題
#### 高度なAI実装の品質問題
- **表面的な実装**: 動作はするが内部ロジックが実用的でない（評価関数がランダム値を返すなど）
- **既存C++実装の無視**: Python で同等機能を再実装し、最適化済みのC++コードを活用しない
- **学習結果の未反映**: AI学習は実行されるが、実際のゲームプレイに学習成果が反映されない
- **デバッグ困難**: 複雑なアルゴリズムの不具合原因を Claude Code が特定・修正できない

#### レート制限への対処
- **61ファイル・13,463行・359,461文字**で5時間制限に到達（memo.md:512-517）
- 履歴なし新セッションで継続するも知識断絶が発生

### 業務適用の提案
#### 適用場面
1. **新プロジェクト立ち上げ**: 基盤コード・テストの高速生成
2. **プロトタイプ開発**: 要件定義から動作する成果物まで
3. **複数言語プロジェクト**: バインディング・インターフェース実装

#### 使い分け戦略
- **Claude Code**: 基本的な実装・テスト・ドキュメント
- **人間**: アルゴリズム設計・パフォーマンス最適化・レビュー
