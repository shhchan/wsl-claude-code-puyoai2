# チケット 012: クイックターン機能修正

## 概要
ぷよぷよ通ルールのクイックターン機能の実装に不具合があることが判明。正しいクイックターン挙動を実装する必要がある。

## 問題の詳細
現在の実装では、軸ぷよの両サイドに障害物がある状態で回転操作を行った際の挙動が仕様と異なる。

### 期待される挙動（ぷよぷよ通ルール）
1. 軸ぷよの左右両側が壁・ぷよで塞がれている状態で回転操作を実行
2. **1回目の回転操作**: 回転は発生せず、次回回転がクイックターンになるフラグを設定
3. **2回目の回転操作**: 180度回転（クイックターン）を実行

### 現在の挙動
- 1回目の回転操作でも通常の回転処理が試行される
- クイックターン専用の状態管理が不適切

## 実装要件

### C++側修正 (`puyo_controller.cpp`)
1. **クイックターン状態フラグの追加**
   ```cpp
   class PuyoController {
   private:
       bool next_rotation_is_quick_turn_;  // 次回回転がクイックターンかのフラグ
   };
   ```

2. **2段階回転処理の実装**
   - 1回目: フラグ設定のみ、回転なし
   - 2回目: 180度回転実行、フラグリセット

3. **フラグリセット条件**
   - 移動操作実行時
   - ペア設置時
   - 新しいペア設定時

### テスト要件
1. 両側が塞がれた状況でのクイックターン動作テスト
2. フラグリセット条件の動作テスト
3. 通常回転との併用テスト

## 関連チケット
- チケット 002: ゲームエンジンコア（PuyoController実装）
- チケット 007b: Python UI バグフィックス（クイックターンテスト除外）

## 実装範囲
- `cpp/core/puyo_controller.h`: フラグ追加
- `cpp/core/puyo_controller.cpp`: 2段階回転ロジック実装
- `tests/`: クイックターン専用テスト追加

## 検収基準
- [ ] 1回目の回転操作で回転が発生しない
- [ ] 2回目の回転操作で180度回転が発生
- [ ] フラグが適切にリセットされる
- [ ] 既存の通常回転機能に影響がない